---
title: "DDIA笔记_存储引擎"
date: 2022-03-27
draft: true
---

# 存储引擎

什么是存储引擎呢？如果说引擎是汽车的核心部件，那存储引擎同样也是数据库的核心部件，它规定了数据存储时的结构、数据增删改查的操作接口，以及索引、锁和其他功能。

在介绍存储引擎之前，得先来了解一下我们处理数据的两种方式：OLTP 和 OLAP。

...

而从数据存储的结构上来看，也会分为行存和列存；为了加速数据的查询，又设计出了各种索引结构。

接下来，就从这几个角度来分别介绍一下概念、原理和优缺点，在掌握了这些有关存储引擎内部的知识，你就能更好地为自己的应用挑选合适的存储引擎，做出更有效的优化。

## 最简单的存储引擎

如果让你用几行代码来实现一个存储引擎（或者数据库），你会怎么做？

我们可以用 linux 命令来实现数据的读取和写入：

```bash
#!/bin/bash
db_set () {
  echo "$1,$2" >> database
}

db_get () {
  grep "^$1," database | sed -e "s/^$1,//" | tail -n 1
}
```

使用 echo 将数据以 key - value （键值对）的形式存入文件；读取时，使用 grep 和 sed 命令来查询、获取 key 对应的 value，并用 tail 命令获取最后一条数据。

这样，我们用两个函数就实现了一个最简单的数据库，可以存入 key - value 结构的数据，而且和很多真正的数据库一样，内部使用 log （日志）数据文件，并且是 append-only（仅追加）的数据文件，而正因为每次写入都是在文本尾部追加，有非常不错的写入性能。

但是读取数据的时候，这个小数据库的性能就不尽人意了。如果存储的数据量很大，每次使用 db_get() 查询时，必须从头到尾扫描整个数据库文件，时间开销是 O(n) 的，意味着如果数据量翻了 n 倍，查询耗时也要翻 n 倍，这是不能接受的。

为了提升数据库的查询性能，我们需要一个特殊的数据结构：index（索引）。索引就像书本的目录，提前存放了关键的元数据，查询时就能通过这个目录快速定位到数据的真实位置，而不用通过耗时的扫描来获取数据。本质上，这也是利用空间来换取时间。

索引是一种额外的数据结构，它不会影响数据库中存放的数据，但是，它会影响数据的写入效率。每次写入数据时，还需要更新、维护相关的索引。所以，对于存储系统而言，这是一个非常重要的 trade-off：选好索引可以加速查询，但是索引又会拖慢写入。

## Hash 索引

